<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<body>
		<div id='PatientSetDownloader-mainDiv'>
			<div id="PatientSetDownloader-TABS" class="yui-navset">
			
				<ul class="yui-nav">
				  <li id="PatientSetDownloader-TAB1" class="selected"><a href="#PatientSetDownloader-TAB1"><em>Specify Data</em></a></li>
				  <li id="PatientSetDownloader-TAB2"><a href="#PatientSetDownloader-TAB2"><em>Preview Data File</em></a></li>
				  <li id="PatientSetDownloader-TAB3"><a href="#PatientSetDownloader-TAB3"><em>Download Data File</em></a></li>
				  <li id="PatientSetDownloader-TAB4"><a href="#PatientSetDownloader-TAB4"><em>History</em></a></li>
				</ul>
				<div class="yui-content" id="PatientSetDownloader-CONTENT">
					
					<!-- Create Data File -->
					<div class="tab-body">
						<div class="PatientSetDownloader-MainContent">
							<h1 style="padding-bottom:10px;"><img src="js-i2b2/cells/plugins/community/PatientSetDownloader/assets/export.png" align="absbottom"/> Patient Set Downloader</h1>
							<div class="PatientSetDownloader-MainContentPad">
							This plugin creates a CSV file with aggregated patient data for a list of patients, one row per patient. To begin, drag and drop a Previous Query containing a patient set to the <strong>Patient(s)</strong> box below. Any concepts found in the query will be automatically added. Additional concepts can be added by dragging them to the <strong>Concept(s)</strong> box below. Each concept in the list will be a column in the CSV file. Use the <strong>Aggregation Option</strong> column to select how columns of data will be aggregated.</span>
</div>
							<div class="droptrgtlbl">Patient(s):</div>
							<div class="droptrgt SDX-PRS" id="PatientSetDownloader-PRSDROP"><img src="js-i2b2/cells/plugins/community/PatientSetDownloader/assets/pointer.png" align="absbottom" style="margin-left:5px;" /> Please Drag &amp; Drop your desired <em>Previous Query</em> with a Patient Set here</div>
							<div style="padding-left: 105px;"><label><input id="PatientSetDownloader-LoadConcepts" type="checkbox" checked="checked">Include concepts from the Previous Query</label> <a href='#' onclick='return false;' data-tooltip='When this option is checked, concepts found in the selected query will be automatically loaded below.'><img style='margin-bottom:-3px;' src='js-i2b2/cells/plugins/community/PatientSetDownloader/assets/tooltip.png'/></a></div>
							<div class="droptrgtlbl">Concept(s):</div>
							<div class="droptrgt SDX-CONCPT" id="PatientSetDownloader-CONCPTDROP"><div class="concptItem"><img src="js-i2b2/cells/plugins/community/PatientSetDownloader/assets/pointer.png" align="absbottom" style="margin-left:5px;" /> Drag &amp; Drop one or more concepts here from <em>Navigate Terms</em> or a <em>Previous Query</em></div></div>
							<div style="padding-left: 105px;"><label><input id="PatientSetDownloader-AppendConcepts" type="checkbox">Append concepts to the list below</label> <a id='tooltip"+i1+"' href='#' onclick='return false;' data-tooltip='When this option is checked, concepts found in a Previous Query will be appended to the list below. Concepts from Navigate Terms will always be appended.'><img style='margin-bottom:-3px;' src='js-i2b2/cells/plugins/community/PatientSetDownloader/assets/tooltip.png'/></a></div>
							<div class="dropConfig" id="PatientSetDownloader-CONCPTCONFIG"></div>
							<div id="PatientSetDownloader-CONCEPTS">
							
							</div>
<!--							<div style="margin-top:15px;text-align:right;width:98%"><input onclick="i2b2.PatientSetDownloader.newResults();" type="button" class="PatientSetDownloader-button" value="Next ( Preview Data File )" /><br/><br/></div><br/>-->
							<div id="PatientSetDownloader-PreviewButton" style="margin-top:15px;text-align:right;width:98%"><input onclick="i2b2.PatientSetDownloader.processJob(1);" type="button" class="PatientSetDownloader-button" value="Next ( Preview Data File )" /><br/><br/><br/></div>
						</div>
					</div>
					
				    <!-- Preview Data File -->
					<div class="tab-body">
						<div class="PatientSetDownloader-MainContent">
							<h1>Preview Data File</h1><br/>
							<div id="no-results-section-prev" class="preview">Please return to the <strong>Specify Data</strong> tab and select a Previous Query with Patient Set and some Concepts to render the Preview</div>
							<div id="results-section" class="preview" style="display:none;">
								<div id="PatientSetDownloader-PreviewText" style="color:#888;padding:10px;font-size:14px;"></div>
								<div id="PatientSetDownloader-ProcessTime" style="color:#888;padding:10px;font-size:14px;"></div>
								<div id="PatientSetDownloader-Status" style="font-size:16px;padding:10px;display:none;">
									<img src="js-i2b2/cells/plugins/community/PatientSetDownloader/assets/ajax.gif" align="absmiddle"/>
								</div><br/>
								<div id="PatientSetDownloader-PreResults">
								</div>
							</div>
							<div style="margin-top:15px;text-align:right;width:98%"><input onclick="$('PatientSetDownloader-TAB1').click();" type="button" class="PatientSetDownloader-button" value="Previous ( Specify Data )" style="float:left" /><input id="PatientSetDownloader-ProceedButton" onclick="i2b2.PatientSetDownloader.processJob(0);" type="button" class="PatientSetDownloader-button" value="Next ( Proceed to Download )" style="float:right;display:none;"/><br/><br/><br/></div>
						</div>
				    </div>
				    <!-- View Data File -->
					<div class="tab-body">
						<div class="PatientSetDownloader-MainContent">
							<h1>Download Data File</h1><br/>
							<div id="no-results-section-file" class="results">You must first <strong>Preview Data File</strong> before you can Download the file</div>
							<div id="results-section-file" class="results">
								<div style='padding: 10px; border-radius: 10px; border: 1px solid rgb(86, 158, 231); color: rgb(86, 158, 231); background: rgb(236, 251, 255);'><img style='margin-top:2px;margin-bottom:2px;' src='js-i2b2/cells/ONT/assets/info_icon.png' align='absmiddle'> Note: Once the processing starts below, you do not need to keep this screen or browser open. The current status and resulting download link will be available through the 'History' tab</div><br/>
								<div id="PatientSetDownloader-ProcessTime" style="color:#888;padding:10px;font-size:11px;"></div>
								<div id="PatientSetDownloader-StatusView" style="font-size:16px;padding:10px;display:none;">
									<img src="js-i2b2/cells/plugins/community/PatientSetDownloader/assets/ajax.gif" align="absmiddle"/> Processed <span id="PatientSetDownloader-Processed" style="font-weight:bold;">0</span> of <span id="PatientSetDownloader-PatientSetSize" style="font-weight:bold;">0</span> patients...
								</div>
								<!--<br/>
								<div id="iframeHolder">
									<iframe id="html5IFrame" src="js-i2b2/cells/plugins/community/PatientSetDownloader/assets/IFrameHTML5.html" frameborder="0" style="width : 175px; height : 40px; border-style : none !important;"></iframe>
									<div id="downloadInstruction"></div>
								</div>-->
								<br/>
								<div id="PatientSetDownloader-ViewResults"></div>
							</div>
						</div>
				    </div>
				    <!-- History -->
					<div class="tab-body">
						<div class="PatientSetDownloader-MainContent">
							<h1>Download History <span id="PatientSetDownloader-HistoryProject"></span></h1><br/>
							<div><a href="#" onclick="i2b2.PatientSetDownloader.getHistory();">Refresh</a></div><br/>
							<div id="PatientSetDownloader-History"></div>
						</div>
				    </div>


					<!-- ############### <LabRange> ############### -->
					<div id="PSV_itemLabRange" style="display:none;">
						<div class="hd">Lab Range Constraint</div>
						<div class="bd modLabValues">
							<div style="margin: 0px 5% 12px; text-align: center;" id="PSV_valueContraintText"></div>
							<div class="mlvBody">
								<div class="mlvtop">
									<div class="mlvModesGroup">
										<div class="mlvMode"><input name="PSV_mlvfrmType" id="PSV_mlvfrmTypeNONE" value="NO_VALUE" type="radio" checked="checked" /> No value</div>
										<div class="mlvMode"><input name="PSV_mlvfrmType" id="PSV_mlvfrmTypeFLAG" value="BY_FLAG" type="radio" /> By flag</div>
										<div class="mlvMode"><input name="PSV_mlvfrmType" id="PSV_mlvfrmTypeVALUE" value="BY_VALUE" type="radio" /> By value</div>
									</div>
									<div class="mlvInputGroup">
										<div id="PSV_mlvfrmFLAG" style="display:none">
											Please select a range:<br />
											<select id='PSV_mlvfrmFlagValue'><option value="">Loading...</option></select>
										</div>
										<div id="PSV_mlvfrmVALUE" style="display:none">
											<p id="PSV_mlvfrmEnterOperator">
												Please select operator:<br />
												<select id='PSV_mlvfrmOperator'>
													<option value="LT">LESS THAN (&lt;)</option>
													<option value="LE">LESS THAN OR EQUAL TO (&lt;=)</option>
													<option value="EQ">EQUAL (=)</option>
													<option value="BETWEEN">BETWEEN</option>
													<option value="GT">GREATER THAN (&gt;)</option>
													<option value="GE">GREATER THAN OR EQUAL (&gt;=)</option>
												</select>
											</p>
											<p id="PSV_mlvfrmEnterStringOperator">
												Please select operator:<br />
												<select id='PSV_mlvfrmStringOperator'>
													<option value="LIKE[contains]">Contains</option>
													<option value="LIKE[exact]">Exact</option>
													<option value="LIKE[begin]">Starts With</option>
													<option value="LIKE[end]">Ends With</option>
												</select>
											</p>
											<p id="PSV_mlvfrmEnterVal">
												Please enter a value:<br />
												<input id="PSV_mlvfrmNumericValue" class="numInput" />
											</p>
											<p id="PSV_mlvfrmEnterVals" style="display:none">
												Please enter values:<br />
												<input id="PSV_mlvfrmNumericValueLow" class="numInput" /> &nbsp;-&nbsp; <input id="PSV_mlvfrmNumericValueHigh" class="numInput" />
											</p>
											<p id="PSV_mlvfrmEnterStr">Enter Search Text:<br /><input id="PSV_mlvfrmStrValue" class="strInput" /> </p>
											<p id="PSV_mlvfrmEnterDbOperator"><input id="PSV_mlvfrmDbOperator" type="checkbox" /> Use Database Operators <i>(Advanced Searching)</i><br /></p>
											<p id="PSV_mlvfrmEnterEnum">
												Please select a value:<br />
												<select id="PSV_mlvfrmEnumValue" class="enumInput" multiple="multiple" size="5" style="overflow: scroll; width: 562px;">
													<option value="">Loading...</option>
												</select>
											</p>
											<div id="PSV_frmEnterRSID" style="width:570px;height:25px;">
													<table>
													<tr>
													<td width="113px"><div style="width:100%;float:left; text-align:left; bottom: 0" id="PSV_frmEnterRSIDText">RS Identifier*:  &nbsp;</div></td>
													<td width="250px"><input id="PSV_frmEnterRSIDValue" class="strInput" value='rs' /></td>
													<td width="208px"><div id="PSV_searchRSID" style="display:none"><img width="20px" src="assets/images/spin.gif"></div></td>
													</tr></table>
											  </div>
											  <div id="PSV_frmEnterGeneName"><br />
												<table><tr>
												<td width="116px"><div style="width:100%;float:left; text-align:left; bottom: 0" id="PSV_frmEnterGeneNameText">Enter Gene Name*:  &nbsp;</div></td>
												<td width="250px"><input id="PSV_frmEnterGeneNameValue" class="strInput" value='rs' /></td>
												<td width="205px"><div id="PSV_searchGeneName" style="display:none"><img width="20px" src="assets/images/spin.gif"></div></td>
												</tr></table>
											  </div>
											  <div id="PSV_ZygosityContainer" style="margin: 2px 2px 0px 0px; display:none;padding-left:2px;" class="genomicsOptionsContainer">
												<div style="width:112px;float:left; text-align:left; bottom: 0;">Zygosity*:  &nbsp;</div>
												<div style="float:left;width:77%;">
												<select id='PSV_zygosityTypes' multiple='multiple'  class="units" style="width: 250px;z-index: 3999; float:left;">
												  <option value="Heterozygous">Heterozygous</option>
												  <option value="Homozygous">Homozygous</option>
												  <option value="missing_zygosity">Missing</option>
												</select>
												</div>
											  </div>
											  <div id="PSV_consequenceContainer" style="margin: 15px 2px 0px 0px; display:none;padding-left:2px;" class="genomicsOptionsContainer">
												<div style="width:112px;float:left; text-align:left; bottom: 0">Consequence:  &nbsp;</div>
												<div style="float:left;width:77%;">
												<select id='PSV_consequenceTypes' multiple='multiple' class="units" style="width: 250px;z-index: 3999; float:left;">
												  <optgroup label="All protein-altering">
													  <option value="Frameshift" class="consequenceOpt">Frameshift</option>
													  <option value="missense" class="consequenceOpt">Missense</option>
													  <option value="nonsense" class="consequenceOpt">Nonsense</option>
													  <option value="start_loss" class="consequenceOpt">Start loss</option>
													  <option value="stop_loss" class="consequenceOpt">Stop loss</option>
												  </optgroup>
												  <optgroup label="All others">
													  <!-- <option value="">Select Protein Altering</option> -->
													  <option value="3'UTR" class="consequenceOpt">3'UTR</option>
													  <option value="5'UTR" class="consequenceOpt">5'UTR</option>
													  <option value="downstream" class="consequenceOpt">Downstream (500 bases)</option>
													  <option value="exon" class="consequenceOpt">Exon (Non-Coding)</option>
													  <option value="In_frame" class="consequenceOpt">In-frame</option>
													  <option value="intron" class="consequenceOpt">Intron</option>
													  <option value="synonymous" class="consequenceOpt">Synonymous</option>
													  <option value="upstream" class="consequenceOpt">Upstream (2 kilobases)</option>
													  <option value="missing_consequence" class="consequenceOpt">Missing</option>
												  </optgroup>
												</select>
												</div>
											  </div>
											</div>
										  </div>
										  <div style="clear:both;height:1px;overflow:hidden;"></div>

									<!-- BEGIN snm0 -->
									<!-- Lab value bars display section -->
									<div id="PSV_mlvfrmBarContainer" style="margin: 10px; padding: 10px; text-align: center; border: 1px solid #000080; height: auto; display:none">
										<!-- <div id="mlvfrmBarContainer" class="barContainer" style="white-space:nowrap; display:none"> -->
										<div style="height: 55px">
											<!-- top text -->
											<div>Click on a bar segment to help specify a value or range:</div>
											<div>Range in <span id="PSV_mlvfrmLblUnits" style="font-decoration:italic bold">mm/Hg</span></div>
											<!-- bars are drawn -->
											<div id="PSV_barToxL" style="float:left; background: none repeat scroll 0% 0% rgb(0, 0, 0); height: 15px; width: 72px;">
												<a href="#PSV_lblToxL" onclick="i2b2.CRC.view.modalLabValues.updateValue(event)" title="Toxic low value" class="barlink">&nbsp;</a>
											</div>
											<div id="PSV_barLofL" style="float:left; background: none repeat scroll 0% 0% rgb(255, 0, 0); height: 15px; width: 72px;">
												<a href="#PSV_lblLofL" onclick="i2b2.CRC.view.modalLabValues.updateValue(event)" title="Abnormal low value" class="barlink">&nbsp;</a>
											</div>
											<div id="PSV_barHofL" style="float:left; background: none repeat scroll 0% 0% rgb(255, 255, 0); height: 15px; width: 72px;">
												<a href="PSV_#lblHofL" onclick="i2b2.CRC.view.modalLabValues.updateValue(event)" title="Indeterminant low value" class="barlink">&nbsp;</a>
											</div>
											<div id="PSV_barNorm" style="float:left; background: none repeat scroll 0% 0% rgb(0, 255, 0); height: 15px; width: 72px;">
												<a href="#" onclick="i2b2.CRC.view.modalLabValues.updateValue(event)" title="Normal" class="barlink">&nbsp;</a>
											</div>
											<div id="PSV_barLofH" style="float:left; background: none repeat scroll 0% 0% rgb(255, 255, 0); height: 15px; width: 72px;">
												<a href="#PSV_lblLofH" onclick="i2b2.CRC.view.modalLabValues.updateValue(event)" title="Indeterminant high value" class="barlink">&nbsp;</a>
											</div>
											<div id="PSV_barHofH" style="float:left; background: none repeat scroll 0% 0% rgb(255, 0, 0); height: 15px; width: 72px;">
												<a href="#PSV_lblHofH" onclick="i2b2.CRC.view.modalLabValues.updateValue(event)" title="Abnormal high value" class="barlink">&nbsp;</a>
											</div>
											<div id="PSV_barToxH" style="float:left; background: none repeat scroll 0% 0% rgb(0, 0, 0); height: 15px; width: 72px;">
												<a href="#PSV_lblToxH" onclick="i2b2.CRC.view.modalLabValues.updateValue(event)" title="Toxic high value" class="barlink">&nbsp;</a>
											</div>
											<!-- labels are drawn -->
											<div id="PSV_lblToxL" style="float: left; text-align: right; width: 72px;">&nbsp;</div>
											<div id="PSV_lblLofL" style="float: left; text-align: right; width: 72px;">&nbsp;</div>
											<div id="PSV_lblHofL" style="float: left; text-align: right; width: 72px;">&nbsp;</div>
											<div id="PSV_lblNorm" style="float: left; text-align: left; width: 72px;">&nbsp;</div>
											<div id="PSV_lblLofH" style="float: left; text-align: left; width: 72px;">&nbsp;</div>
											<div id="PSV_lblHofH" style="float: left; text-align: left; width: 72px;">&nbsp;</div>
											<div id="PSV_lblToxH" style="float: left; text-align: left; width: 72px;">&nbsp;</div>
										</div>
									</div>

									<!-- Units display section -->
									<div id="PSV_mlvfrmUnitsContainer" style="margin: 10px 0px 0px 15px; display:none">
										<div style="float:left; text-align:left; bottom: 0">Units = &nbsp;</div>
										<span><select id='PSV_mlvfrmUnits' class="units" style="width: 500px; float:left;"><option value="0">Loading...</option></select></span>
										<span id="PSV_mlvUnitExcluded" style="color:#900; margin-left: 20px">A value cannot be specified for these units.</span>
									</div>
									<!-- END snm0 -->
								</div>
							</div>
						</div>
					</div>
					<!-- ############### </LabRange> ############### -->
					
					<!-- ############### <Date Range Constraint Dialog> ############### -->
					<div id="dateConstraintDialog" style="display:none;">
						<div class="hd">Constrain by Date Range</div>
						<div class="bd">
							<br />
							<center>
								<table style="font-size:12px">
									<tr><td>From:</td><td></td><td>To:</td></tr>
									<tr>
										<td class="dateBorder">
											<table>
												<tr>
													<td valign="middle"><input id="PSV_CheckboxDateStart" type="checkbox" onchange="i2b2.PatientSetDownloader.UI.DateConstraint.toggleDate()" /></td>
													<td valign="middle"><input id="PSV_ConstraintDateStart" value="01/31/2008" style="width:75px;" disabled="disabled" /></td>
													<td valign="middle"><a href="Javascript:i2b2.PatientSetDownloader.UI.DateConstraint.doShowCalendar('S')"><img id="PSV_DropDateStart" style="position:relative; top:1px; border:none;" class="calendarDropdown" src="assets/images/b_dropdown.gif" alt="" /></a>&nbsp;</td>
												</tr>
											</table>
										</td>
										<td>&nbsp;&nbsp;&nbsp;</td>
										<td class="dateBorder">
											<table>
												<tr>
													<td valign="middle"><input id="PSV_CheckboxDateEnd" type="checkbox" onchange="i2b2.PatientSetDownloader.UI.DateConstraint.toggleDate()" /></td>
													<td valign="middle"><input id="PSV_ConstraintDateEnd" value="12/31/2008" style="width:75px;" disabled="disabled" /></td>
													<td valign="middle"><a href="Javascript:i2b2.PatientSetDownloader.UI.DateConstraint.doShowCalendar('E');"><img id="PSV_DropDateEnd" style="position:relative; top:1px" class="calendarDropdown" border="0" src="assets/images/b_dropdown.gif" alt="" /></a>&nbsp;</td>
												</tr>
											</table>
										</td>
									</tr>
								</table>
							</center>
							<br /><br />
						</div>
					</div>
					<!-- ############### </Date Range Constraint Dialog> ############### -->
					<form style="display: hidden" action="js-i2b2/cells/plugins/community/PatientSetDownloader/download.php" method="POST" id="downloadForm">
						<input type="hidden" name="user_id" value=""/>
						<input type="hidden" name="session" value=""/>
						<input type="hidden" name="job_id" value=""/>
						<input type="hidden" name="domain" value=""/>
						<input type="hidden" name="pm_uri" value=""/>
					</form>
				</div>

			
			</div>

		</div>
	</body>
</html>
